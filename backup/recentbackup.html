<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Schedule</title>
    <style>
        :root {
            --blue: #3b82f6;
            --orange: #f97316;
            --green: #22c55e;
            --red: #ef4444;
            --purple: #8b5cf6;
            --yellow: #eab308;
            --light: #f3f4f6;
            --dark: #1f2937;
            --white: #ffffff;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f9fafb;
            color: var(--dark);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: var(--white);
            border-radius: 12px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(to right, #3b82f6, #8b5cf6);
            color: var(--white);
            padding: 30px;
            text-align: center;
            border-radius: 12px 12px 0 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        header p {
            font-size: 16px;
            opacity: 0.9;
            font-weight: 500;
            letter-spacing: 0.2px;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 24px;
            background-color: var(--white);
            border-bottom: 1px solid #e5e7eb;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .date-display {
            font-size: 20px;
            font-weight: 600;
            color: #374151;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            background-color: var(--blue);
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.25s ease;
            font-size: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
            letter-spacing: 0.2px;
        }
        
        .btn:hover {
            background-color: #2563eb; /* Slightly darker blue on hover */
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.12), 0 2px 4px rgba(0, 0, 0, 0.08);
        }
        
        .btn:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .btn-group {
            display: flex;
            gap: 12px;
        }
        
        .tabs {
            display: flex;
            padding: 0 24px;
            border-bottom: 1px solid #e5e7eb;
            background-color: var(--white);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }
        
        .tab {
            padding: 14px 24px;
            cursor: pointer;
            font-weight: 500;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
            color: #6b7280;
            font-size: 15px;
        }
        
        .tab:hover {
            color: var(--blue);
            background-color: rgba(59, 130, 246, 0.05);
        }
        
        .tab.active {
            border-bottom: 3px solid var(--blue);
            color: var(--blue);
            font-weight: 600;
        }
        
        .schedule-container {
            padding: 20px;
        }
        
        .schedule {
            border-radius: 8px;
            overflow: hidden;
            padding: 10px;
        }
        
        .event {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            margin-bottom: 8px;
            border-radius: 10px;
            transition: all 0.3s;
            position: relative;
            background-color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05), 0 1px 2px rgba(0, 0, 0, 0.1);
            border: 1px solid #eaeaea;
        }
        
        .event:hover {
            background-color: rgba(255, 255, 255, 1);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08), 0 2px 4px rgba(0, 0, 0, 0.12);
            transform: translateY(-1px);
        }
        
        .event-time {
            width: 150px;
            font-weight: 500;
            font-size: 14px;
        }
        
        .event-content {
            display: flex;
            align-items: center;
            flex: 1;
        }
        
        .event-emoji {
            margin-right: 10px;
            font-size: 20px;
        }
        
        .event-title {
            font-weight: 500;
        }
        
        .event-description {
            display: none;
        }
        
        .event-popup {
            position: fixed;
            top: 0;
            right: -400px;
            width: 380px;
            height: 100vh;
            background-color: white;
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            transition: right 0.3s ease-in-out;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        
        .event-popup.active {
            right: 0;
        }
        
        .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .popup-title {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }
        
        .popup-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #6b7280;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .popup-close:hover {
            background-color: #f3f4f6;
            color: #1f2937;
        }
        
        .popup-content {
            padding: 20px;
            line-height: 1.6;
            color: #4b5563;
        }
        
        .popup-time {
            font-weight: 500;
            margin-bottom: 15px;
            color: #6b7280;
            display: flex;
            align-items: center;
        }
        
        .popup-time-icon {
            margin-right: 8px;
        }
        
        .popup-description {
            font-size: 15px;
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.3);
            z-index: 999;
            display: none;
        }
        
        .overlay.active {
            display: block;
        }
        
        .school { border-left: 4px solid var(--blue); }
        .basketball { border-left: 4px solid var(--orange); }
        .study { border-left: 4px solid var(--green); }
        .fun { border-left: 4px solid var(--red); }
        .reminder { border-left: 4px solid var(--purple); }
        .routine { border-left: 4px solid var(--yellow); }
        
        .add-event-form {
            margin-top: 20px;
            padding: 20px;
            background-color: var(--light);
            border-radius: 8px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        input, select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
        }
        
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
            padding: 15px;
            background-color: var(--light);
            border-radius: 8px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            font-size: 14px;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
            margin-right: 5px;
        }
        
        .info-tip {
            background-color: rgba(59, 130, 246, 0.1);
            border-left: 4px solid var(--blue);
            padding: 10px 15px;
            margin-bottom: 15px;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .info-tip p {
            margin: 0;
        }
        
        .current-event {
            background-color: rgba(243, 244, 246, 0.8);
            border-left-width: 6px !important;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }
        
        .hidden {
            display: none;
        }
        
        /* Drag and drop styles */
        .dragging {
            opacity: 0.7;
            transform: scale(0.98);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }
        
        .section-content.drop-zone-active {
            background-color: rgba(59, 130, 246, 0.1);
            border-radius: 8px;
            padding: 10px;
            transition: all 0.2s;
        }
        
        .event[draggable=true] {
            cursor: grab;
        }
        
        .event[draggable=true]:active {
            cursor: grabbing;
        }
        
        /* New styles for collapsible sections */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background-color: var(--light);
            border-radius: 10px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 4px solid var(--blue);
        }
        
        .section-header:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            background-color: #e9edf5;
        }
        
        .section-title {
            font-weight: 700;
            font-size: 16px;
            color: var(--dark);
        }
        
        .section-arrow {
            font-size: 16px;
            transition: transform 0.3s;
        }
        
        .section-header.active .section-arrow {
            transform: rotate(90deg);
        }
        
        .section-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            padding: 0 5px;
        }
        
        .section-content.active {
            max-height: 1500px; /* Arbitrary large value, adjusted based on content */
            transition: max-height 0.5s ease-in;
        }
    </style>
</head>
<body>
    <div class="overlay"></div>
    <div class="event-popup">
        <div class="popup-header">
            <h3 class="popup-title">Event Details</h3>
            <button class="popup-close">&times;</button>
        </div>
        <div class="popup-content">
            <div class="popup-time">
                <span class="popup-time-icon">🕒</span>
                <span class="popup-time-text"></span>
            </div>
            <div class="popup-description"></div>
        </div>
    </div>
    
    <div class="container">
        <header>
            <h1>My Interactive Schedule</h1>
            <p>Organize your day effectively</p>
        </header>
        
        <div class="controls">
            <div class="date-display">
                <span id="current-date">Today</span>
            </div>
            <div class="btn-group">
                <button class="btn" id="prev-day">Previous Day</button>
                <button class="btn" id="today">Today</button>
                <button class="btn" id="next-day">Next Day</button>
            </div>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="weekday">Weekday Schedule</div>
            <div class="tab" data-tab="weekend">Weekend Schedule</div>
            <div class="tab" data-tab="custom">Add Custom Events</div>
        </div>
        
        <div class="schedule-container">
            <div class="info-tip">
                <p>💡 <strong>Tip:</strong> Hover over each activity to see detailed guidance on what to do during this time block.</p>
            </div>
            <div class="tab-content" id="weekday-tab">
                <div class="schedule" id="weekday-schedule">
                    <!-- Weekday schedule will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="tab-content hidden" id="weekend-tab">
                <div class="schedule" id="weekend-schedule">
                    <!-- Weekend schedule will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="tab-content hidden" id="custom-tab">
                <div class="add-event-form">
                    <h3>Add Custom Event</h3>
                    <form id="add-event-form">
                        <div class="form-group">
                            <label for="event-date">Date:</label>
                            <input type="date" id="event-date" required>
                        </div>
                        <div class="form-group">
                            <label for="event-start-time">Start Time:</label>
                            <input type="time" id="event-start-time" required>
                        </div>
                        <div class="form-group">
                            <label for="event-end-time">End Time:</label>
                            <input type="time" id="event-end-time" required>
                        </div>
                        <div class="form-group">
                            <label for="event-title">Title:</label>
                            <input type="text" id="event-title" required>
                        </div>
                        <div class="form-group">
                            <label for="event-emoji">Emoji:</label>
                            <input type="text" id="event-emoji" placeholder="🏀">
                        </div>
                        <div class="form-group">
                            <label for="event-category">Category:</label>
                            <select id="event-category">
                                <option value="school">School/Classes</option>
                                <option value="basketball">Basketball</option>
                                <option value="study">Homework/Study</option>
                                <option value="fun">Gaming/Fun/Ari Time</option>
                                <option value="reminder">Reminders</option>
                                <option value="routine">Sleep & Meals</option>
                            </select>
                        </div>
                        <button type="submit" class="btn">Add Event</button>
                    </form>
                </div>
                
                <div class="custom-events-list">
                    <h3>Your Custom Events</h3>
                    <div id="custom-events">
                        <!-- Custom events will be populated here -->
                    </div>
                </div>
            </div>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: var(--blue);"></div>
                    <span>School/Classes</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: var(--orange);"></div>
                    <span>Basketball</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: var(--green);"></div>
                    <span>Homework/Study</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: var(--red);"></div>
                    <span>Gaming/Fun/Ari Time</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: var(--purple);"></div>
                    <span>Reminders</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: var(--yellow);"></div>
                    <span>Sleep & Meals</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Schedule data
            const weekdaySchedule = [
                { time: '5:20–6:00 AM', emoji: '🧘', title: 'Wake Up + Get Ready for Workout', category: 'routine', description: "Start your day with purpose. As soon as you wake up at 5:20 AM, brush your teeth, wash your face, and make your bed to set a productive tone. Drink a glass of water to rehydrate and jumpstart your system. If you have time, prepare your workout bag—lay out your clothes, check your water bottle, and organize anything you'll need for the session. This 40-minute block isn't just about moving slowly—it's about waking your body up while mentally preparing to own the day." },
                { time: '6:00–7:00 AM', emoji: '💪', title: 'Workout or Yoga', category: 'routine' },
                { time: '7:00–7:10 AM', emoji: '🍳', title: 'Weekday Breakfast', category: 'routine' },
                { time: '7:10–7:30 AM', emoji: '🎒', title: 'Get Ready + Leave for School', category: 'routine' },
                { time: '7:30–2:56 PM', emoji: '🏫', title: 'School', category: 'school' },
                { time: '3:00–4:00 PM (Tue/Wed)', emoji: '📚', title: 'Homework / Study (Math & Debate)', category: 'study', days: [2,3] },
                { time: '4:00–4:20 PM (Mon)', emoji: '🚗', title: 'Get Ready for Bobby Training', category: 'basketball', days: [1] },
                { time: '4:20–7:00 PM (Mon)', emoji: '🏀', title: 'Bobby Basketball Training', category: 'basketball', days: [1] },
                { time: '7:00–8:00 PM (Wed)', emoji: '🏀', title: 'Personal Training with Rene', category: 'basketball', days: [3] },
                { time: '4:00–5:45 PM (Thu)', emoji: '🧠', title: 'AoPS Class', category: 'school', days: [4] },
                { time: '5:45–6:00 PM (Thu)', emoji: '🍌', title: 'Snack + Break', category: 'reminder', days: [4] },
                { time: '6:00–8:00 PM (Thu)', emoji: '🗣️', title: 'Debate', category: 'school', days: [4] },
                { time: '6:55–8:15 PM (Tue)', emoji: '🏀', title: 'Basketball Practice', category: 'basketball', days: [2] },
                { time: '7:00–8:00 PM (Fri)', emoji: '🏀', title: 'Rene Practice', category: 'basketball', days: [5] },
                { time: 'Evenings (Free blocks)', emoji: '🎮', title: 'Gaming / 🧠 Extra Study / 😌 Ari Time', category: 'fun' },
                { time: '8:30–9:00 PM (Not Tue/Fri)', emoji: '🪥', title: 'Wind Down + Get Ready for Bed', category: 'routine', days: [1,3,4] },
                { time: '9:00–9:15 PM (Tue/Fri)', emoji: '🪥', title: 'Wind Down + Get Ready for Bed', category: 'routine', days: [2,5] },
                { time: '8:30–5:20 AM (Not Tue/Fri)', emoji: '💤', title: 'Sleep', category: 'routine', days: [1,3,4] },
                { time: '9:15–5:20 AM (Tue/Fri)', emoji: '💤', title: 'Sleep', category: 'routine', days: [2,5] },
            ];
            
            const weekendSchedule = [
                { time: '5:20–6:00 AM', emoji: '🧘', title: 'Wake Up + Get Ready', category: 'routine' },
                { time: '6:00–7:00 AM', emoji: '💪', title: 'Workout or Yoga', category: 'routine' },
                { time: '7:30–8:00 AM', emoji: '🍳', title: 'Weekend Breakfast', category: 'routine' },
                { time: 'Game time varies', emoji: '🏀', title: 'Basketball Games (Add per week manually)', category: 'basketball' },
                { time: 'Post-game block', emoji: '🎮', title: 'Gaming or 📚 Study (If free)', category: 'fun' },
                { time: 'Evening (if no game)', emoji: '😌', title: 'Ari Time / Chill / Family', category: 'fun' },
                { time: '9:00–9:15 PM', emoji: '🪥', title: 'Wind Down + Get Ready for Bed', category: 'routine' },
                { time: '9:15–5:20 AM', emoji: '💤', title: 'Sleep', category: 'routine' }
            ];
            
            // DOM elements
            const currentDateElement = document.getElementById('current-date');
            const prevDayButton = document.getElementById('prev-day');
            const nextDayButton = document.getElementById('next-day');
            const todayButton = document.getElementById('today');
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            const weekdayScheduleElement = document.getElementById('weekday-schedule');
            const weekendScheduleElement = document.getElementById('weekend-schedule');
            const addEventForm = document.getElementById('add-event-form');
            const customEventsContainer = document.getElementById('custom-events');
            
            // State
            let currentDate = new Date();
            let customEvents = [];
            let draggedEvent = null; // Track the currently dragged event
            
            // Try to load from localStorage if available, otherwise use default empty array
            try {
                const storedEvents = localStorage.getItem('customEvents');
                if (storedEvents) {
                    customEvents = JSON.parse(storedEvents);
                }
            } catch (error) {
                // Silent fallback to in-memory storage
                customEvents = [];
            }
            
            // Initialize the application
            updateDateDisplay();
            renderSchedule();
            renderCustomEvents();
            highlightCurrentEvent();
            setupEventPopup();
            
            // Set up interval to highlight current event every minute
            setInterval(highlightCurrentEvent, 60000);
            
            function setupEventPopup() {
                const popup = document.querySelector('.event-popup');
                const closeBtn = document.querySelector('.popup-close');
                const overlay = document.querySelector('.overlay');
                
                closeBtn.addEventListener('click', closePopup);
                overlay.addEventListener('click', closePopup);
            }
            
            function showEventDetails(event) {
                const popup = document.querySelector('.event-popup');
                const overlay = document.querySelector('.overlay');
                const popupTitle = document.querySelector('.popup-title');
                const popupTimeText = document.querySelector('.popup-time-text');
                const popupDescription = document.querySelector('.popup-description');
                
                // Set the border color based on category
                const categoryColor = getCategoryColor(event.category);
                popup.style.borderLeft = `4px solid ${categoryColor}`;
                
                // Fill in the content
                popupTitle.textContent = event.title;
                popupTimeText.textContent = event.time;
                popupDescription.textContent = event.description || 'No description available.';
                
                // Show the popup and overlay
                popup.classList.add('active');
                overlay.classList.add('active');
                
                // Add body style to prevent scrolling
                document.body.style.overflow = 'hidden';
            }
            
            function closePopup() {
                const popup = document.querySelector('.event-popup');
                const overlay = document.querySelector('.overlay');
                
                popup.classList.remove('active');
                overlay.classList.remove('active');
                
                // Restore body scrolling
                document.body.style.overflow = '';
            }
            
            function getCategoryColor(category) {
                switch(category) {
                    case 'school': return '#3b82f6'; // blue
                    case 'basketball': return '#f97316'; // orange
                    case 'study': return '#22c55e'; // green
                    case 'fun': return '#ef4444'; // red
                    case 'reminder': return '#8b5cf6'; // purple
                    case 'routine': return '#eab308'; // yellow
                    default: return '#3b82f6'; // default blue
                }
            }
            
            // Event listeners
            prevDayButton.addEventListener('click', () => {
                currentDate.setDate(currentDate.getDate() - 1);
                updateDateDisplay();
                renderSchedule();
                highlightCurrentEvent();
            });
            
            nextDayButton.addEventListener('click', () => {
                currentDate.setDate(currentDate.getDate() + 1);
                updateDateDisplay();
                renderSchedule();
                highlightCurrentEvent();
            });
            
            todayButton.addEventListener('click', () => {
                currentDate = new Date();
                updateDateDisplay();
                renderSchedule();
                highlightCurrentEvent();
            });
            
            // Handle mobile taps for event descriptions
            document.addEventListener('click', function(e) {
                if (window.innerWidth <= 768) {
                    const eventElement = e.target.closest('.event');
                    if (eventElement) {
                        // Toggle the active class for this event
                        const wasActive = eventElement.classList.contains('active');
                        
                        // Remove active class from all events
                        document.querySelectorAll('.event').forEach(el => {
                            el.classList.remove('active');
                        });
                        
                        // If this event wasn't active before, make it active
                        if (!wasActive) {
                            eventElement.classList.add('active');
                        }
                        
                        e.stopPropagation();
                    } else {
                        // If clicking outside an event, remove all active classes
                        document.querySelectorAll('.event').forEach(el => {
                            el.classList.remove('active');
                        });
                    }
                }
            });
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    const tabName = tab.getAttribute('data-tab');
                    tabContents.forEach(content => {
                        content.classList.add('hidden');
                    });
                    document.getElementById(`${tabName}-tab`).classList.remove('hidden');
                });
            });
            
            addEventForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const date = document.getElementById('event-date').value;
                const startTime = document.getElementById('event-start-time').value;
                const endTime = document.getElementById('event-end-time').value;
                const title = document.getElementById('event-title').value;
                const emoji = document.getElementById('event-emoji').value || '📌';
                const category = document.getElementById('event-category').value;
                
                const newEvent = {
                    id: Date.now(),
                    date,
                    time: `${formatTime(startTime)}–${formatTime(endTime)}`,
                    title,
                    emoji,
                    category,
                    description: 'Custom event added to your schedule.'
                };
                
                customEvents.push(newEvent);
                
                // Try to save to localStorage, fallback to just updating the in-memory array
                try {
                    localStorage.setItem('customEvents', JSON.stringify(customEvents));
                } catch (error) {
                    console.log('Could not save to localStorage, using in-memory storage only');
                }
                
                renderCustomEvents();
                addEventForm.reset();
                
                // Show a success message
                try {
                    alert('Event added successfully!');
                } catch (error) {
                    console.log('Alert not available in this environment');
                    // Show notification instead
                    const notification = document.createElement('div');
                    notification.className = 'info-tip';
                    notification.style.backgroundColor = 'rgba(16, 185, 129, 0.1)';
                    notification.style.borderLeftColor = 'var(--green)';
                    notification.innerHTML = '<p>✅ Event added successfully!</p>';
                    
                    const formElement = addEventForm.parentNode;
                    formElement.insertBefore(notification, addEventForm);
                    
                    // Remove notification after 3 seconds
                    setTimeout(() => {
                        notification.remove();
                    }, 3000);
                }
            });
            
            // Functions
            function updateDateDisplay() {
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                currentDateElement.textContent = currentDate.toLocaleDateString(undefined, options);
                
                // Show weekday or weekend schedule based on the day
                const dayOfWeek = currentDate.getDay(); // 0 = Sunday, 6 = Saturday
                if (dayOfWeek === 0 || dayOfWeek === 6) {
                    document.querySelector('[data-tab="weekend"]').click();
                } else {
                    document.querySelector('[data-tab="weekday"]').click();
                }
            }
            
            function renderSchedule() {
                // Clear existing schedule
                weekdayScheduleElement.innerHTML = '';
                weekendScheduleElement.innerHTML = '';
                
                const dayOfWeek = currentDate.getDay(); // 0 = Sunday, 6 = Saturday
                
                // For weekday schedule, create two sections
                if (dayOfWeek >= 1 && dayOfWeek <= 5) {
                    // Create morning section
                    const morningSection = createSection('Morning + School', 'weekday-morning');
                    weekdayScheduleElement.appendChild(morningSection.header);
                    weekdayScheduleElement.appendChild(morningSection.content);
                    
                    // Create afternoon section
                    const afternoonSection = createSection('Afternoon + Evening', 'weekday-afternoon');
                    weekdayScheduleElement.appendChild(afternoonSection.header);
                    weekdayScheduleElement.appendChild(afternoonSection.content);
                    
                    // Process each event
                    const morningEvents = [];
                    const afternoonEvents = [];
                    
                    weekdaySchedule.forEach(event => {
                        // Skip the gaming block on Monday-Thursday
                        if (event.title.includes('Gaming') && dayOfWeek >= 1 && dayOfWeek <= 4) {
                            return; // Skip this event
                        }
                        
                        // Check if the event should be shown on the current weekday
                        if (event.days && !event.days.includes(dayOfWeek)) {
                            return; // Skip event not for this day
                        }
                        
                        // Modify workout event based on day of week
                        if (event.title.includes('Workout or Yoga')) {
                            let workoutEvent = {...event}; // Clone the event
                            
                            // Set workout title and emoji based on day of week
                            switch(dayOfWeek) {
                                case 0: // Sunday
                                    workoutEvent.title = 'Rest Day';
                                    workoutEvent.emoji = '☀️';
                                    break;
                                case 1: // Monday
                                case 3: // Wednesday 
                                case 5: // Friday
                                    workoutEvent.title = 'Yoga';
                                    workoutEvent.emoji = '🧘';
                                    break;
                                case 2: // Tuesday
                                case 4: // Thursday
                                case 6: // Saturday
                                    workoutEvent.title = 'Workout';
                                    workoutEvent.emoji = '💪';
                                    break;
                            }
                            
                            // Determine if it's a morning or afternoon event
                            // For workout, we know it's always morning
                            morningEvents.push(workoutEvent);
                        } else {
                            // Determine if it's a morning or afternoon event
                            // Special case for sleep events - always put in afternoon section
                            if (event.title.includes('Sleep') || isAfternoonEvent(event.time)) {
                                afternoonEvents.push(event);
                            } else {
                                morningEvents.push(event);
                            }
                        }
                    });
                    
                    // Add custom events for the current date
                    const currentDateString = currentDate.toISOString().split('T')[0];
                    const todayCustomEvents = customEvents.filter(event => event.date === currentDateString);
                    
                    todayCustomEvents.forEach(event => {
                        const isAfternoon = isAfternoonEvent(event.time);
                        if (isAfternoon) {
                            afternoonEvents.push(event);
                        } else {
                            morningEvents.push(event);
                        }
                    });
                    
                    // Render morning events
                    morningEvents.forEach(event => {
                        const eventElement = createEventElement(event);
                        morningSection.content.appendChild(eventElement);
                    });
                    
                    // Render afternoon events
                    afternoonEvents.forEach(event => {
                        const eventElement = createEventElement(event);
                        afternoonSection.content.appendChild(eventElement);
                    });
                    
                    // Open the first section by default
                    setTimeout(() => {
                        toggleSection(morningSection.header);
                    }, 100);
                } 
                // For weekend schedule, also create two sections
                else {
                    // Create morning section
                    const morningSection = createSection('Morning + Active Time', 'weekend-morning');
                    weekendScheduleElement.appendChild(morningSection.header);
                    weekendScheduleElement.appendChild(morningSection.content);
                    
                    // Create afternoon section
                    const afternoonSection = createSection('Afternoon + Evening', 'weekend-afternoon');
                    weekendScheduleElement.appendChild(afternoonSection.header);
                    weekendScheduleElement.appendChild(afternoonSection.content);
                    
                    // Process each event
                    const morningEvents = [];
                    const afternoonEvents = [];
                    
                    weekendSchedule.forEach(event => {
                        // Handle weekend workout
                        if (event.title.includes('Workout or Yoga')) {
                            let workoutEvent = {...event}; // Clone the event
                            
                            // Set workout title and emoji based on day of week
                            switch(dayOfWeek) {
                                case 0: // Sunday
                                    workoutEvent.title = 'Rest Day';
                                    workoutEvent.emoji = '☀️';
                                    break;
                                case 6: // Saturday
                                    workoutEvent.title = 'Workout';
                                    workoutEvent.emoji = '💪';
                                    break;
                            }
                            
                            morningEvents.push(workoutEvent);
                        } 
                        // Skip gaming blocks on weekdays (Mon-Thu)
                        else if (event.title.includes('Gaming') && dayOfWeek >= 1 && dayOfWeek <= 4) {
                            return; // Skip this event
                        }
                        else {
                            // Categorize as morning or afternoon
                            if (event.title.includes('Basketball') || 
                                event.title.includes('Wake Up') || 
                                event.title.includes('Breakfast')) {
                                morningEvents.push(event);
                            } else {
                                afternoonEvents.push(event);
                            }
                        }
                    });
                    
                    // Add custom events for the current date
                    const currentDateString = currentDate.toISOString().split('T')[0];
                    const todayCustomEvents = customEvents.filter(event => event.date === currentDateString);
                    
                    todayCustomEvents.forEach(event => {
                        const isAfternoon = isAfternoonEvent(event.time);
                        if (isAfternoon) {
                            afternoonEvents.push(event);
                        } else {
                            morningEvents.push(event);
                        }
                    });
                    
                    // Render morning events
                    morningEvents.forEach(event => {
                        const eventElement = createEventElement(event);
                        morningSection.content.appendChild(eventElement);
                    });
                    
                    // Render afternoon events
                    afternoonEvents.forEach(event => {
                        const eventElement = createEventElement(event);
                        afternoonSection.content.appendChild(eventElement);
                    });
                    
                    // Open the first section by default
                    setTimeout(() => {
                        toggleSection(morningSection.header);
                    }, 100);
                }
            }
            
            function isAfternoonEvent(timeString) {
                // Check if time starts at or after 3:00 PM
                if (timeString.includes('–')) {
                    const startTime = timeString.split('–')[0].trim();
                    if (startTime.includes('PM') && !startTime.includes('12:')) {
                        return true;
                    }
                    if (startTime.includes(':')) {
                        const hour = parseInt(startTime.split(':')[0]);
                        if (hour >= 15) { // 3 PM or later in 24-hour format
                            return true;
                        }
                    }
                }
                
                // For text-based times like "Evenings"
                if (timeString.includes('Evening') || 
                    timeString.includes('Night') || 
                    timeString.includes('PM')) {
                    return true;
                }
                
                return false;
            }
            
            function createSection(title, id) {
                // Create section header
                const header = document.createElement('div');
                header.className = 'section-header';
                header.dataset.target = id;
                header.innerHTML = `
                    <div class="section-title">${title}</div>
                    <div class="section-arrow">▶</div>
                `;
                
                // Create section content
                const content = document.createElement('div');
                content.className = 'section-content';
                content.id = id;
                
            // Add drop zone functionality to section content
                content.addEventListener('dragover', handleDragOver);
                content.addEventListener('dragenter', handleDragEnter);
                content.addEventListener('dragleave', handleDragLeave);
                content.addEventListener('drop', handleDrop);
                
                // Add click event to header
                header.addEventListener('click', function() {
                    toggleSection(this);
                });
                
                return { header, content };
            }
            
            function toggleSection(headerElement) {
                // Get all headers and contents
                const allHeaders = document.querySelectorAll('.section-header');
                const allContents = document.querySelectorAll('.section-content');
                
                // Get target content
                const targetId = headerElement.dataset.target;
                const targetContent = document.getElementById(targetId);
                
                // Close all sections first
                allHeaders.forEach(header => header.classList.remove('active'));
                allContents.forEach(content => content.classList.remove('active'));
                
                // Toggle the clicked section
                headerElement.classList.toggle('active');
                targetContent.classList.toggle('active');
                
                // Update arrow icon
                const arrow = headerElement.querySelector('.section-arrow');
                arrow.textContent = headerElement.classList.contains('active') ? '▼' : '▶';
            }
            
            function createEventElement(event) {
                const eventElement = document.createElement('div');
                eventElement.className = `event ${event.category}`;
                
                // Make custom events draggable (if they have an id, which indicates they're custom)
                if (event.id) {
                    eventElement.setAttribute('draggable', 'true');
                    eventElement.dataset.eventId = event.id;
                    
                    // Add drag event listeners
                    eventElement.addEventListener('dragstart', handleDragStart);
                    eventElement.addEventListener('dragend', handleDragEnd);
                }
                
                eventElement.innerHTML = `
                    <div class="event-time">${event.time}</div>
                    <div class="event-content">
                        <div class="event-emoji">${event.emoji}</div>
                        <div class="event-title">${event.title}</div>
                    </div>
                    <div class="event-actions">
                        <button class="btn-details">View Details</button>
                    </div>
                    <div class="event-description">${event.description || ''}</div>
                `;
                
                const detailsButton = eventElement.querySelector('.btn-details');
                detailsButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    showEventDetails(event);
                });
                
                return eventElement;
            }
            
            function renderCustomEvents() {
                customEventsContainer.innerHTML = '';
                
                if (customEvents.length === 0) {
                    customEventsContainer.innerHTML = '<p>No custom events added yet.</p>';
                    return;
                }
                
                // Sort custom events by date and time
                customEvents.sort((a, b) => {
                    if (a.date !== b.date) {
                        return new Date(a.date) - new Date(b.date);
                    }
                    return a.time.localeCompare(b.time);
                });
                
                customEvents.forEach(event => {
                    const eventElement = document.createElement('div');
                    eventElement.className = `event ${event.category}`;
                    
                    // Format the date
                    const eventDate = new Date(event.date);
                    const formattedDate = eventDate.toLocaleDateString(undefined, {
                        weekday: 'short',
                        month: 'short',
                        day: 'numeric'
                    });
                    
                    eventElement.innerHTML = `
                        <div class="event-time">${formattedDate} | ${event.time}</div>
                        <div class="event-content">
                            <div class="event-emoji">${event.emoji}</div>
                            <div class="event-title">${event.title}</div>
                        </div>
                        <button class="btn" data-id="${event.id}" style="margin-left: 10px; background-color: var(--danger);">Delete</button>
                    `;
                    
                    customEventsContainer.appendChild(eventElement);
                    
                    // Add delete event listener
                    const deleteButton = eventElement.querySelector('button');
                    deleteButton.addEventListener('click', () => {
                        const eventId = parseInt(deleteButton.getAttribute('data-id'));
                        customEvents = customEvents.filter(e => e.id !== eventId);
                        
                        // Try to save to localStorage, fallback to just updating the in-memory array
                        try {
                            localStorage.setItem('customEvents', JSON.stringify(customEvents));
                        } catch (error) {
                            console.log('Could not save to localStorage, using in-memory storage only');
                        }
                        
                        renderCustomEvents();
                        renderSchedule();
                    });
                });
            }
            
            function highlightCurrentEvent() {
                // Remove current highlighting
                document.querySelectorAll('.event').forEach(event => {
                    event.classList.remove('current-event');
                });
                
                // Only highlight if viewing today
                const today = new Date();
                if (
                    currentDate.getDate() === today.getDate() &&
                    currentDate.getMonth() === today.getMonth() &&
                    currentDate.getFullYear() === today.getFullYear()
                ) {
                    const now = new Date();
                    const currentHour = now.getHours();
                    const currentMinute = now.getMinutes();
                    
                    // Function to check if a time range includes the current time
                    function isCurrentTimeInRange(timeRange) {
                        const [startEnd, dayInfo] = timeRange.split(' (');
                        const [start, end] = startEnd.split('–');
                        
                        // Parse start time
                        let [startHour, startMinPart] = start.split(':');
                        startHour = parseInt(startHour);
                        let startMin = parseInt(startMinPart);
                        if (start.includes('PM') && startHour < 12) startHour += 12;
                        if (start.includes('AM') && startHour === 12) startHour = 0;
                        
                        // Parse end time
                        let [endHour, endMinPart] = end.split(':');
                        endHour = parseInt(endHour);
                        let endMin = parseInt(endMinPart);
                        if (end.includes('PM') && endHour < 12) endHour += 12;
                        if (end.includes('AM') && endHour === 12) endHour = 0;
                        
                        // Check if current time is in range
                        if (
                            (currentHour > startHour || (currentHour === startHour && currentMinute >= startMin)) &&
                            (currentHour < endHour || (currentHour === endHour && currentMinute <= endMin))
                        ) {
                            return true;
                        }
                        
                        return false;
                    }
                    
                    // Get all events from all sections for today's schedule
                    const events = document.querySelectorAll('.event');
                    
                    // Check each event to see if we're currently in its time range
                    events.forEach(event => {
                        const timeElement = event.querySelector('.event-time');
                        if (timeElement) {
                            const timeText = timeElement.textContent;
                            
                            // Special handling for "Evenings" and other text-based times
                            if (timeText.includes('Evenings') && currentHour >= 19 && currentHour < 21) {
                                event.classList.add('current-event');
                                
                                // Expand section containing this event
                                const parentSection = event.closest('.section-content');
                                if (parentSection && !parentSection.classList.contains('active')) {
                                    const header = document.querySelector(`[data-target="${parentSection.id}"]`);
                                    if (header) {
                                        toggleSection(header);
                                    }
                                }
                            }
                            // Special handling for sleep time that crosses midnight
                            else if ((timeText.includes('8:30–5:20') || timeText.includes('9:15–5:20')) && 
                                    ((currentHour >= 21) || (currentHour >= 20 && currentMinute >= 30) || currentHour < 5 || 
                                     (currentHour === 5 && currentMinute < 20))) {
                                event.classList.add('current-event');
                                
                                // Expand section containing this event
                                const parentSection = event.closest('.section-content');
                                if (parentSection && !parentSection.classList.contains('active')) {
                                    const header = document.querySelector(`[data-target="${parentSection.id}"]`);
                                    if (header) {
                                        toggleSection(header);
                                    }
                                }
                            }
                            // Try to parse the time range for other events
                            else if (timeText.includes('–')) {
                                try {
                                    if (isCurrentTimeInRange(timeText)) {
                                        event.classList.add('current-event');
                                        
                                        // Expand section containing this event
                                        const parentSection = event.closest('.section-content');
                                        if (parentSection && !parentSection.classList.contains('active')) {
                                            const header = document.querySelector(`[data-target="${parentSection.id}"]`);
                                            if (header) {
                                                toggleSection(header);
                                            }
                                        }
                                    }
                                } catch (e) {
                                    // Skip if we can't parse the time
                                    console.log('Could not parse time:', timeText);
                                }
                            }
                        }
                    });
                }
            }
            
            function formatTime(time24h) {
                const [hours, minutes] = time24h.split(':');
                const hour = parseInt(hours);
                const suffix = hour >= 12 ? 'PM' : 'AM';
                const displayHour = hour % 12 || 12;
                return `${displayHour}:${minutes} ${suffix}`;
            }
            
            // Drag and drop event handlers
            function handleDragStart(e) {
                draggedEvent = this;
                
                // Set data for drop
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/plain', this.dataset.eventId);
                
                setTimeout(() => {
                    this.classList.add('dragging');
                }, 0);
            }
            
            function handleDragEnd(e) {
                this.classList.remove('dragging');
                draggedEvent = null;
            }
            
            function handleDragOver(e) {
                e.preventDefault(); // Necessary to allow dropping
                e.dataTransfer.dropEffect = 'move';
                return false;
            }
            
            function handleDragEnter(e) {
                this.classList.add('drop-zone-active');
            }
            
            function handleDragLeave(e) {
                this.classList.remove('drop-zone-active');
            }
            
            function handleDrop(e) {
                e.preventDefault();
                e.stopPropagation();
                
                this.classList.remove('drop-zone-active');
                
                if (!draggedEvent) return false;
                
                // Get the event ID
                const eventId = parseInt(e.dataTransfer.getData('text/plain'));
                const targetSection = this;
                
                // Find the custom event
                const eventIndex = customEvents.findIndex(event => event.id === eventId);
                if (eventIndex === -1) return false;
                
                // Move the element to the new section
                targetSection.appendChild(draggedEvent);
                
                // Mark that this event has been moved to this section
                // We're just making a visual change, not updating localStorage
                if (targetSection.id.includes('morning')) {
                    customEvents[eventIndex].sectionOverride = 'morning';
                } else if (targetSection.id.includes('afternoon')) {
                    customEvents[eventIndex].sectionOverride = 'afternoon';
                }
                
                return false;
            }
        });
    </script>
</body>
</html>